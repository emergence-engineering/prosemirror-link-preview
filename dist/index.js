"use strict";var e=require("prosemirror-state"),t=require("prosemirror-model"),r=require("prosemirror-view");require("y-prosemirror");const i=(e,t,r)=>{const i=document.createElement("div");i.className="preview-root";const s=document.createElement("img");s.classList.add("preview-img"),s.src=e.attrs.src,s.alt=e.attrs.alt;const o=document.createElement("div");o.classList.add("preview-title"),o.textContent=e.attrs.title;const n=document.createElement("div");n.classList.add("preview-description"),n.textContent=e.attrs.description,i.appendChild(s),i.appendChild(o),i.appendChild(n);const l=i;return{dom:l,update:e=>{if(e.type!=e.type)return!1;const t=l.querySelector("img"),r=l.querySelector(".preview-title"),i=l.querySelector(".preview-description");return!!(t&&r&&i)&&(t.src=e.attrs.src,t.alt=e.attrs.alt,i.textContent=e.attrs.description,r.textContent=e.attrs.title,!0)},selectNode:()=>{const{state:e,dispatch:i}=t;i(e.tr.setMeta("selectedNode",r()))},deselectNode:()=>{const{state:e,dispatch:r}=t;r(e.tr.setMeta("selectedNode",null))},destroy:()=>{l.remove()}}},s=new e.PluginKey("previewPlugin"),o=(e,t)=>{let r=s.getState(e).find(void 0,void 0,(e=>e.id==t));return r.length?r[0].from:null};exports.addPreviewNode=e=>e.addToEnd("preview",{inline:!0,group:"inline",atom:!1,attrs:{src:{default:null},alt:{default:null},title:{default:null},description:{default:null}},parseDOM:[{tag:"div",getAttrs(e){var t,r,i,s;return e instanceof HTMLElement?{src:null===(t=e.querySelector(".preview-img"))||void 0===t?void 0:t.getAttribute("src"),alt:null===(r=e.querySelector(".preview-img"))||void 0===r?void 0:r.getAttribute("alt"),title:null===(i=e.querySelector(".preview-title"))||void 0===i?void 0:i.textContent,description:null===(s=e.querySelector(".preview-description"))||void 0===s?void 0:s.textContent}:{}}}],toDOM:e=>["div",{class:"preview-root"},["img",{class:"preview-img",src:e.attrs.src,alt:e.attrs.alt}],["div",{class:"preview-title"},e.attrs.title],["div",{class:"preview-description"},e.attrs.description]]}),exports.previewNodeView=i,exports.previewPlugin=(n,l)=>new e.Plugin({key:s,state:{init:()=>[],apply:(e,t,r,i)=>t},props:{decorations:e=>r.DecorationSet.empty,transformPasted:(e,r)=>{var i;let d={},a=r.state.tr;a.selection.empty||a.deleteSelection(),a.setMeta(s,{id:d,pos:a.selection.from,type:"add"}),r.dispatch(a);const c=null===(i=e.content.firstChild)||void 0===i?void 0:i.textContent;let p=null;try{p=new URL(c||"").origin}catch(t){return e}if(c&&p){l(c).then((e=>{const{title:t,description:i,images:l}=e,a={title:t,description:i,src:l[0],url:c},p=n.nodes.preview.create(a);let u=o(r.state,d);null!=u&&setTimeout((()=>{r.dispatch(r.state.tr.replaceWith(u,u,p).setMeta(s,{type:"remove",id:d}))}),5e3)}),(()=>{r.dispatch(a.setMeta(s,{type:"remove",id:d}))}));const e=t.Fragment.empty;return new t.Slice(e,0,0)}return e},nodeViews:{preview:i}}});
